<!DOCTYPE html>
<html lang="en-US" />
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>Forecasting Profits Direction: Weekly Stop-Loss and Stop-Gain &middot; Tech Vagabond! - Gabriele LUCULLI&#39;s Web Page</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://techvagabond.org/favicon.ico" />
    <link rel="canonical" href="https://techvagabond.org/forecasting-profits-direction-weekly-stop-loss-and-stop-gain/" />

     <meta name="description" content="In a previous post we backtested our logistic model with walk-forward and we found two useful trading configurations, one for Monday-Wednesday and the other for" /> 

     
    
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://techvagabond.org/img/blog-pnl-bt-sgsl/generic-title.jpg"/>
    
 
    <meta name="twitter:title" content="Forecasting Profits Direction: Weekly Stop-Loss and Stop-Gain"/>
    <meta name="twitter:description" content="In a previous post we backtested our logistic model with walk-forward and we found two useful trading configurations, one for Monday-Wednesday and the other for"/>
    <meta name="twitter:url" content="https://techvagabond.org/forecasting-profits-direction-weekly-stop-loss-and-stop-gain/" />
    <meta name="twitter:site" content="@"/>

    <meta property="og:site_name" content="Tech Vagabond! - Gabriele LUCULLI&#39;s Web Page" />
    <meta property="og:title" content="Forecasting Profits Direction: Weekly Stop-Loss and Stop-Gain &middot; Gabriele LUCULLI&#39;s Web Page" />
    <meta property="og:url" content="https://techvagabond.org/forecasting-profits-direction-weekly-stop-loss-and-stop-gain/" />
    

    <meta property="og:type" content="article" />
    <meta property="og:description" content="In a previous post we backtested our logistic model with walk-forward and we found two useful trading configurations, one for Monday-Wednesday and the other for" />

    <meta property="article:published_time" content="2020-12-10T14:57:38&#43;02:00" />
    <meta property="article:tag" content="Technology" /><meta property="article:tag" content="Machine learning" /><meta property="article:tag" content="Finance" />

    <meta property="og:image" content="https://techvagabond.org/img/blog-pnl-bt-sgsl/generic-title.jpg"/>


    <meta name="generator" content="Hugo 0.75.1" />

    <!-- Stylesheets -->
    <link rel="stylesheet" type="text/css" href="https://techvagabond.org/built/screen.css" /> 
    <link rel="stylesheet" type="text/css" href="https://techvagabond.org/css/casper-two.css" /> 
    <link rel="stylesheet" type="text/css" href="https://techvagabond.org/css/overrides.css" /> 
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" />
     <link rel="stylesheet" href="https://techvagabond.org/css/overrides.css" /> 

     

    
    
    <link rel="apple-touch-icon" sizes="180x180" href="img/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon/favicon-16x16.png">
    <link rel="manifest" href="img/favicon/site.webmanifest">
    <link rel="mask-icon" href="img/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="img/favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="img/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
</head>


<body class="ctsingle">

  <div class="site-wrapper"> 

<header class="site-header outer "  style="background-image: url(https://techvagabond.org/img/mountains-sun.jpeg)"  >
  <div class="inner">
    <div class="site-header-content">
      <h1 class="site-title"> Gabriele LUCULLI&#39;s Web Page  </h1>
        <h2 class="site-description">Technology | Finance | Research | Engineering </h2>
    </div>

    <nav class="site-nav">
      <div class="site-nav-left"><ul class="nav" role="menu">
        
        
        
            <li class="" role="menuitem">
              <a href="/">Home</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/categories/papers/">Papers</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/categories/projects/">Projects</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/categories/blog/">Blog</a>
            </li>
        
      </ul></div>

      <div class="site-nav-right">
        <div class="social-links">
                    

                    

                    <a class="social-link" href="https://github.com/luculli" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>

                    

                    
        </div>  
            
      </div>

    </nav>  

  </div>
</header>


<main id="site-main" class="site-main outer" role="main">
  <div class="inner">
    
    <div class="post-feed">
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="https://techvagabond.org/forecasting-profits-direction-weekly-stop-loss-and-stop-gain/">
      <div class="post-card-image" style="background-image: url(https://techvagabond.org/img/blog-pnl-bt-sgsl/generic-title.jpg)"></div>
    </a>
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="https://techvagabond.org/forecasting-profits-direction-weekly-stop-loss-and-stop-gain/">
          <header class="post-card-header">
              <span class="post-card-tags">
              #Technology 
              #Machine learning 
              #Finance  </span>
              
              <h2 class="post-card-title">Forecasting Profits Direction: Weekly Stop-Loss and Stop-Gain</h2>
          </header>
      </a>
      <section class="post-card-excerpt" style="padding: 0 25px;">
          <div class="text-abstract">   
<p>In a previous post we <a href="https://techvagabond.org/forecasting-profits-direction-pnl-backtesting/">backtested</a>
 our logistic model with walk-forward and we found two useful trading configurations, one for Monday-Wednesday and the other for Tuesday-Thursday-Friday. They are reported hereafter.</p>
<div class="image-row"> 
  <div class="image-column">
    <img src="../img/blog-pnl-bt/pnl-logit-0-075-13-global.png" style="width:110% centering">
  </div>
  <div class="image-column">  
    <img src="../img/blog-pnl-bt/pnl-logit-0-075-245.png" style="width:110% centering">
  </div>
</div>
<p>Now, a question we could have is, do there is any way to improve our pnl ? We know that we could try a different machine learning paradigm in order to improve our training metrics (i.e. accuracy, sensitivity and specificity) but, assuming we don&rsquo;t want to go to this direction, we can still try to improve our pnl by reducing our losses. So the key question is how much we could gain if we could &ldquo;guess&rdquo; which among the selected trades will eventually result on a loss.</p>
<p>A rough way to do such estimation is to compute for each configuration and for each week of backtesting its maximum pnl, the result is in the following two images. We can see that there is a lot of space of pnl improvement in both configurations. However, it is fair to recognize that the values reported on such images are the &ldquo;ideal&rdquo; case which can only be reached by a golden oracle, we can only hope to gain some fraction of such values. Instead, it is extremely interesting to remark how <strong>the maximum pnl shapes are independent from the chosen time frame</strong>. This is really important because it tells us that our forecasting model has a stationary behavior versus the time frame parameter, i.e. we are not expected to gain or lose anything choosing a time frame instead of another one. And, therefore, we can have more confidence on the long-term reliability of our model.</p>
<div class="image-row"> 
  <div class="image-column">
    <img src="../img/blog-pnl-bt-sgsl/sgsl-dow13/maxpnl-0-13-global.png" style="width:110% centering">
  </div>
  <div class="image-column">  
    <img src="../img/blog-pnl-bt-sgsl/sgsl-dow245/maxpnl-0-245.png" style="width:110% centering">
  </div>
</div>
<p>Of course, we can also compute the minimum pnl. As we can see there is also much room to loose money instead of gaining. This is to remember us that improving our pnl is not a free lunch, we need to find the right metrics and the right algorithms. Still, they confirm our previous remark on the stationary behavior of our model. In addition, we can see that maximum and minimal values of pnl are on the same absolute range for each configuration and for each year (for example, max for dow13 2019 is around 1500-2000 and the same is for the min but with negatives values).</p>
<div class="image-row"> 
  <div class="image-column">
    <img src="../img/blog-pnl-bt-sgsl/sgsl-dow13/minpnl-0-13-global.png" style="width:110% centering">
  </div>
  <div class="image-column">  
    <img src="../img/blog-pnl-bt-sgsl/sgsl-dow245/minpnl-0-245.png" style="width:110% centering">
  </div>
</div>
<p>A possible way to improve our pnl is to set a <strong>stop-loss</strong> and a <strong>stop-gain</strong> on a given period of time. In order to validate such idea, we have backtested the pnl by adding a weekly stop-loss (WSL) and a weekly stop-gain (WSG). Stops are checked at the end of each trade, when one is hit the trading is stop for the actual day and the coming days of the week. The backstesting was done for several levels, positive for the stop-gain and negative for the stop-loss: 5, 10, 15, 20, 25, 30, 35 and 100.</p>
<p>The following picture shows the total pnl at the end of the five years for each couple &lt;WSG, WSL&gt; and each timeframe in the case of DOW245. The <strong>yellow point</strong> is the optimal pnl without stop-loss or stop-gain, so for example in the timeframe 0.5 we get the original optimal pnl just over 800. Instead, the <strong>orange point</strong> is the global optimal for the given timeframe considering all the possible couples &lt;WSG, WSL&gt;. In this case, we can see that applying stop-gain and stop-loss to the timeframes 1.0 and 1.5 can result on an improved pnl. Actually, considering the timeframe 1.5 the improvement is extremely important, from pnl around 0 to around 500. However, considering all the three timeframes, the optimal configuration is still in the timeframe 0.5 and the global optimal (orange point) is basically at the same level of pnl of the original optimal. So, <em><u>overall there is no gain in pnl by applying weekly stop-loss and stop-gain</u></em> to DOW245 configuration.</p>
<img src="../img/blog-pnl-bt-sgsl/sgsl_3d_m0_ud1_gm0_dow245.gif">
<p>The result is quite different for the case DOW13, like we can see in the following picture. The pnl can be improved of around 200 points, reaching around 900 points in timeframe 1.0 and 1.5 by applying &lt;WSG, WSL&gt;=&lt;+20, -35&gt;.</p>
<img src="../img/blog-pnl-bt-sgsl/sgsl_3d_m0_ud1_gm1_dow13.gif">
<p>We can analyse the configuration DOW13 in mode details by checking the contribution of each single day. If we do this we will discover that most of the pnl contribution belong to Wednesday alone where there is an optimal global configuration of &lt;WSG, WSL&gt;=&lt;nolimit, -5&gt; for timeframe 1.0, resulting on a total pnl of around 700 in 5 years. Doing the same for Monday we discover that its total contribution is around 200 points which are gained the first year and then there is no major gain. So, the conclusion is that <u><em>it is more interesting to trade only Wednesday with &lt;WSG, WSL&gt;=&lt;nolimit, -5&gt; and to avoid the trading fees for Monday</em></u>.</p>
<img src="../img/blog-pnl-bt-sgsl/sgsl_3d_m0_ud1_gm1_dow3.gif">
<p>In summary, we can gain something by applying a weekly stop-loss and stop-gain but not much and, in any case, very far from the potential gains we expected. The final trading strategy is:</p>
<ul>
<li>
<p>DOW245: baseline strategy with timeframe 0.5</p>
</li>
<li>
<p>DOW3: baseline strategy time frame 1.0 and weekly stop-loss of -5</p>
</li>
<li>
<p>DOW1: no trades</p>
</li>
</ul>
</div>
 <!--  local JS and CSS libraries -->
<script src="../js/zooming.min.js"></script>
 <script>
    new Zooming({
      bgColor: 'rgb(FF, 0, 0)',
      bgOpacity: 0
    }).listen('img')
</script>
<style>
    figure {
      margin: 30px auto
    }

</style>  
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
    crossorigin="anonymous">
      </section>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="https://techvagabond.org/img/profile-picture-gl.jpg" alt="Author" />
          <span class="post-card-author"><a href="/">Gabriele Luculli</a></span>
      </footer>
    </div>
</article>
    </div>

    <nav class="pagination" role="navigation">
      
      <span class="page-number">&nbsp;</span>
      
          <a class="older-posts" href="/analysis-and-classification-of-aerial-lidar-data/"><span class="hide">Previous Post</span> &rarr;</a>
      
    </nav>

    
    
    

  </div>
</main>



<footer class="site-footer outer">
  <div class="site-footer-content inner">
    <section class="copyright" style="line-height: 1.3em;">
      <a href="/"></a> v0.5.0 - Dec/2020 - GL ©2020 - root@techvagabond.org <br>
      
    </section>
    <nav class="site-footer-nav">
        <a href="/">Latest Posts</a>
        
        
        <a href="https://github.com/luculli" target="_blank" rel="noopener">Github</a>
        
        
    </nav>  
  </div>
</footer>

</div>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script type="text/javascript" src="//code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="https://techvagabond.org/js/jquery.fitvids.js"></script>

<script>hljs.initHighlightingOnLoad();</script>




</body></html>
